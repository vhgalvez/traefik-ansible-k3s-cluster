# playbooks\apply_ingress_and_middlewares.yml
---
- name: ðŸš€ Aplicar IngressRoute del Dashboard de Traefik (Fase 1)
  hosts: localhost
  gather_facts: false

  vars_files:
    - ../vars/main.yml

  vars:
    kubeconfig_path: "/home/victory/.kube/config"
    kubectl_path: "/usr/local/bin/kubectl"

  tasks:
    - name: ðŸ“„ Renderizar IngressRoute interno para el dashboard de Traefik
      template:
        src: ../templates/traefik/traefik-dashboard-ingressroute-internal.yaml.j2
        dest: /tmp/ingress-dashboard.yaml

    - name: ðŸš€ Aplicar IngressRoute del dashboard
      command: "{{ kubectl_path }} apply -f /tmp/ingress-dashboard.yaml"
      environment:
        KUBECONFIG: "{{ kubeconfig_path }}"