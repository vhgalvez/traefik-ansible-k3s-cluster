# playbooks\deploy_traefik.yml
- name: ğŸš€ Instalar Traefik con Helm dentro del clÃºster K3s
  hosts: localhost
  gather_facts: false
  tasks:
    - name: ğŸ“ Asegurar directorio local files/
      file:
        path: "{{ playbook_dir }}/files"
        state: directory

    - name: ğŸ“„ Renderizar values.yaml desde plantilla
      template:
        src: "../templates/traefik/values.yaml.j2"
        dest: "{{ playbook_dir }}/files/traefik-values.yaml"

    - name: âŒ Desinstalar Traefik por defecto de K3s (si existe)
      command: "kubectl delete helmcharts traefik -n kube-system"
      ignore_errors: true

    - name: â• AÃ±adir repositorio Helm de Traefik
      shell: helm repo add traefik https://traefik.github.io/charts && helm repo update

    - name: ğŸš€ Instalar Traefik con Helm
      shell: helm upgrade --install traefik traefik/traefik              --namespace kube-system              --create-namespace              -f {{ playbook_dir }}/files/traefik-values.yaml